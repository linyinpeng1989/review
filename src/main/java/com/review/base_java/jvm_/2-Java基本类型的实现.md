[《深入拆解 Java 虚拟机》02 | Java的基本类型](https://time.geekbang.org/column/article/11503)

---

Java引进了八个基本类型来支持数值计算，因为基本类型能够在执行效率以及内存使用两方面提升软件性能。

### 1、Java虚拟机的boolean类型
在 Java 语言规范中，boolean 类型的值只有两种可能，它们分别用符号“true”和“false”来表示。显然，这两个符号是不能被虚拟机直接使用的。在Java 虚拟机规范中，boolean 类型则被映射成 int 类型。具体来说，
“true”被映射为整数 1，而“false”被映射为整数 0。Java 虚拟机规范同时也要求 Java 编译器遵守这个编码规则，并且用整数相关的字节码来实现逻辑运算，以及基于 boolean 类型的条件跳转。

```
public class Foo {
  public static void main(String[] args) {
    boolean 吃过饭没 = 2; // 直接编译的话 javac 会报错
    if (吃过饭没) System.out.println(" 吃了 ");
    if (true == 吃过饭没) System.out.println(" 真吃了 ");
  }
}
```
如果运行这段代码（通过直接修改字节码的方式）你就会发现，问虚拟机“吃过饭没”，它会回答“吃了”，而问虚拟机“真（==）吃过饭没”，虚拟机则不会回答“真吃了”。对于Java 虚拟机来说，它看到的 boolean 类型，
早已被映射为整数类型。因此，将原本声明为 boolean 类型的局部变量，赋值为除了 0、1 之外的整数值，在 Java 虚拟机看来是“合法”的。在上述例子中，经过编译器编译之后，Java 虚拟机看到的不是在问“吃过饭没”，
而是在问“吃过几碗饭”。也就是说，第一个 if 语句变成：你不会一碗饭都没吃吧。第二个 if 语句则变成：你吃过一碗饭了吗。


### 2、Java的基本类型
- boolean：布尔类型，占1个字节，用于判断真或假（仅有两个值，即true、false），默认值false
- byte：Java中最小的数据类型，在内存中占8位(bit)，即1个字节，取值范围-128~127，默认值0
- short：短整型，在内存中占16位，即2个字节，取值范围-32768~32717，默认值0
- char：字符型，用于存储单个字符，占16位，即2个字节，取值范围0~65535，默认值为'\u0000'
- int：整型，用于存储整数，在内在中占32位，即4个字节，取值范围-2147483648~2147483647，默认值0
- long：长整型，在内存中占64位，即8个字节-2^63~2^63-1，默认值0L
- float：浮点型，在内存中占32位，即4个字节，用于存储带小数点的数字（与double的区别在于float类型有效小数点只有6~7位），默认值+0.0F
- double：双精度浮点型，用于存储带有小数点的数字，在内存中占64位，即8个字节，默认值+0.0D

尽管它们的默认值看起来不一样，但在内存中都是 0。这些基本类型之中，浮点类型比较特殊，基于它的运算或比较，需要考虑 +0.0F、-0.0F 以及 NaN 的情况。


##### ①针对局部变量（栈）
对于boolean、byte、char、short这四种类型，在栈上占用的空间和int、引用类型是一样的，但它们在堆中占用的大小却不同。因此，在32位的HotSpot中，这些类型在栈上将占用4个字节；而64位的HotSpot中，他们将占用8个字节。当然，
这种情况仅存在于局部变量，而并不会出现在存储于堆中的字段或者数组元素上。即将boolean、byte、char 以及 short 的值存入字段或者数组单元时不需要进行掩码操作，赋值多少就是多少。


##### ②针对全局变量（堆）
对于byte、char以及short这三种类型的字段或者数组单元，它们在堆上占用的空间分别为一字节、两字节以及两字节。因此，当我们将一个Int类型的值存储到这些类型的字段或者数组时，相当于做了一次隐式的掩码
操作（高两位的字节会被截取掉）。boolean字段和boolean数组则比较特殊，在HotSpot中boolean类型占用一个字节，而boolean数组则直接用byte数组来实现的。为了保证堆的boolean类型值是合法的，HotSpot在将一个
Int类型的值存储到boolean字段或数组时，显式地进行掩码操作（比如boolean = 3，二进制位11，进行掩码操作获取低位0，因此在堆中存储的boolean值为1，即表示true）。也就是说，只取最后一位的值存入boolean字段或数组中。

在将 boolean、byte、char 以及 short 的值存入字段或者数组单元时（不包含局部变量），Java 虚拟机会进行掩码操作。在读取时，Java 虚拟机则会将其扩展为 int 类型。



